.memo-screen {
    @apply hidden flex-1 relative;

    min-height: calc(100svh - var(--pt) - var(--pb));

    @media (min-width: 768px) {
        margin-left: calc(var(--sidebar-width) + var(--spacing) * 1);
    }
}

.memo-screen-drag-handle {
    @apply fixed;
    width: 15vw;
    left: -5vw;
    z-index: 10;
    touch-action: none;
    top: calc(env(safe-area-inset-top, 0px) + var(--spacing) * 10);
    bottom: calc(env(safe-area-inset-bottom, 0px) + var(--spacing) * 10);
}

.memo-screen:has(.memo.is-editing) .memo-screen-drag-handle {
    display: none;
}

.memo-screen:has([aria-hidden="false"]) {
    @apply block;
}

.open-memo-tab-panels {
    display: contents;
}

.memo-tab-panel {
    @apply flex flex-col relative;
    width: 100%;
    min-height: calc(100vh - env(safe-area-inset-bottom, 0px));
    container: memo-tab-panel / size;

    &:focus-visible {
        @apply outline-3 outline-offset-0 outline-primary rounded-2xl;
    }

    animation: memo-open-from-right 120ms
        linear(
            0,
            0.012 0.9%,
            0.05 2%,
            0.411 9.2%,
            0.517 11.8%,
            0.611 14.6%,
            0.694 17.7%,
            0.765 21.1%,
            0.824 24.8%,
            0.872 28.9%,
            0.91 33.4%,
            0.939 38.4%,
            0.977 50.9%,
            0.994 68.4%,
            1
        );

    @media (min-width: 768px) {
        animation: unset;
        translate: unset;
        padding-top: var(--pt);
        padding-bottom: var(--pb);
        padding-right: var(--pl);
    }
}

.dragging-memo-tab .memo-tab-panel {
    @apply shadow-xl;
    translate: var(--memo-tab-back-progress, 0%) 0;
    touch-action: none;
}

:root:has(.dragging-memo-tab) {
    touch-action: none;
}

.memo-tab-panel-memo {
    @apply bg-body py-0 border border-surface-border shadow-xs flex-1;
    @apply flex justify-center;
    padding-top: env(safe-area-inset-top, 0px);

    @media (min-width: 768px) {
        @apply rounded-2xl pt-0;
    }

    @container (width >= 1024px) {
        @apply px-4 pt-0;
    }
}

.memo-tab-panel-memo .memo {
    width: 100%;
    height: auto;
    min-height: calc(100cqh - var(--spacing) * 8);
    --max-content-width: 1024px;

    .memo-content {
        @apply px-2;
    }

    .memo-tab-panel-close-btn {
        order: 1;
        .btn {
            @apply aspect-square h-11 w-11 elevation-2;
        }

        @container (width >= 1224px) {
            @apply absolute left-2;

            .btn {
                @apply h-11 w-11;
                aspect-ratio: unset;
            }
        }
    }

    .memo-actions-lg .btn,
    .memo-tab-panel-close-btn {
        animation: mobile-memo-title-actions linear;
        animation-timeline: scroll(root);
        animation-range-end: 200px;
        animation-fill-mode: both;

        transition: filter 150ms linear;
        filter: blur(0px);
        @starting-style {
            filter: blur(20px);
        }

        @container (width >= 1224px) {
            @starting-style {
                filter: blur(0px);
            }
        }
    }

    .memo-title-mobile-float {
        text-align: center;
        position: fixed;
        top: calc(
            max(env(safe-area-inset-top, 0px), calc(2 * var(--spacing))) +
            1lh
        );
        left: max(env(safe-area-inset-left, 0px), calc(2 * var(--spacing)));
        right: max(env(safe-area-inset-right, 0px), calc(2 * var(--spacing)));
        z-index: calc(var(--mobile-top-fadeout-z-index, 0) + 10);
        pointer-events: none;

        & > span {
            display: block;
            font-size: var(--base-font-size);
            font-weight: bold;
            filter: blur(10px);
            opacity: 0;
            animation: mobile-memo-title-float linear;
            animation-timeline: scroll(root);
            animation-range-end: 200px;
            animation-fill-mode: both;
        }

        .memo-date {
            font-size: var(--xs-font-size);
            width: 100%;
            place-content: center;
            filter: blur(10px);
            opacity: 0;
            animation: mobile-memo-title-float linear;
            animation-timeline: scroll(root);
            animation-range-end: 200px;
            animation-fill-mode: both;
        }

        @container (width >= 768px) {
            @apply hidden;
        }

        &::before {
            position: absolute;
            display: block;
            pointer-events: none;
            content: "";
            right: -10%;
            top: 0;
            left: -10%;
            z-index: -1;
            height: var(--mobile-top-fadeout-height);
            --mobile-top-fadeout-to-adjust: calc(-1 * env(safe-area-inset-top));

            backdrop-filter: blur(2px);
            mask-image: linear-gradient(to top, transparent 10%, black 50%);
            background-image: linear-gradient(
                to top,
                transparent,
                var(--color-body-bg) 80%
            );

            animation: mobile-top-fadeout linear;
            animation-timeline: scroll(root);
            animation-range-end: 200px;
            animation-fill-mode: both;
            translate: 0
                calc(
                    -1 *
                    var(--mobile-top-fadeout-height) *
                    2 +
                    env(safe-area-inset-top, 0px) +
                    var(--mobile-top-fadeout-to-adjust, 0px)
                );

            @media (min-width: 768px) {
                @apply hidden;
            }
        }
    }
}

@keyframes mobile-memo-title-float {
    0% {
        opacity: 0;
        translate: 0 2lh;
        filter: blur(10px);
    }

    50% {
        opacity: 0;
        translate: 0 2lh;
        filter: blur(10px);
    }

    to {
        opacity: 1;
        translate: 0 calc(-1 * env(safe-area-inset-top, 2lh) / 2);
        filter: blur(0px);
    }
}

@keyframes mobile-memo-title-actions {
    from {
        translate: 0 0;
        transform: scale(1);
        filter: blur(0px);
    }

    to {
        translate: 0 -50%;
        transform: scale(0);
        filter: blur(40px);
    }
}

.memo-tab-panel-memo .editor {
    @apply flex items-center;
    min-height: calc(100% - (var(--spacing)));

    .text-editor {
        @apply flex-1 p-2 tablet:p-4;
    }

    .cm-editor {
        height: 100%;
    }
}

.memo-screen .memo-actions {
    @apply elevation-2;
    @container (width >= 320px) {
        .memo-actions-sm {
            @apply hidden;
        }

        .memo-actions-md {
            @apply flex;
        }
    }

    @container (width >= 700px) {
        .memo-actions-lg {
            @apply flex;
        }

        .memo-actions-md {
            @apply hidden;
        }

        .memo-actions-sm {
            @apply hidden;
        }
    }
}

.memo-tab-transition {
    view-transition-name: memo-tab-reveal;

    .memo-tab-panel[aria-hidden="false"] {
        view-transition-name: memo-tab;
    }

    @media (min-width: 768px) {
        view-transition-name: unset;
        .memo-tab-panel[aria-hidden="false"] {
            view-transition-name: unset;
        }
    }
}

:root::view-transition-old(memo-tab-reveal) {
    display: block;
    animation: memo-open-to-left 150ms
        linear(
            0,
            0.012 0.9%,
            0.05 2%,
            0.411 9.2%,
            0.517 11.8%,
            0.611 14.6%,
            0.694 17.7%,
            0.765 21.1%,
            0.824 24.8%,
            0.872 28.9%,
            0.91 33.4%,
            0.939 38.4%,
            0.977 50.9%,
            0.994 68.4%,
            1
        )
        both;
    @media (min-width: 768px) {
        display: none;
    }
}

:root::view-transition-new(memo-tab-reveal) {
    display: none;
}

:root::view-transition-new(memo-tab) {
    animation: memo-open-from-right 150ms
        linear(
            0,
            0.012 0.9%,
            0.05 2%,
            0.411 9.2%,
            0.517 11.8%,
            0.611 14.6%,
            0.694 17.7%,
            0.765 21.1%,
            0.824 24.8%,
            0.872 28.9%,
            0.91 33.4%,
            0.939 38.4%,
            0.977 50.9%,
            0.994 68.4%,
            1
        );
    @media (min-width: 768px) {
        display: none;
    }
}

@keyframes memo-open-from-right {
    from {
        translate: 100% 0;
    }

    to {
        translate: 0 0;
    }
}

@keyframes memo-open-to-left {
    from {
        translate: 0 0;
    }

    to {
        translate: -50% 0;
    }
}

.close-memo-tab-transition {
    view-transition-name: close-memo-tab-list-screen;

    .memo-tab-panel[aria-hidden="false"] {
        view-transition-name: close-memo-tab-closed;
    }

    @media (min-width: 768px) {
        view-transition-name: unset;
        .memo-tab-panel[aria-hidden="false"] {
            view-transition-name: unset;
        }
    }
}

:root::view-transition-group(close-memo-tab-list-screen) {
    animation: none;
}

:root::view-transition-old(close-memo-tab-list-screen) {
    display: none;
    animation: none;
    /* mix-blend-mode: unset; */
}

:root::view-transition-new(close-memo-tab-list-screen) {
    animation: close-memo-tab-list-screen 120ms
        linear(
            0,
            0.012 0.9%,
            0.05 2%,
            0.411 9.2%,
            0.517 11.8%,
            0.611 14.6%,
            0.694 17.7%,
            0.765 21.1%,
            0.824 24.8%,
            0.872 28.9%,
            0.91 33.4%,
            0.939 38.4%,
            0.977 50.9%,
            0.994 68.4%,
            1
        )
        both;

    @media (min-width: 768px) {
        display: none;
    }
}

:root::view-transition-old(close-memo-tab-closed) {
    animation: close-memo-tab-closed 150ms
        linear(
            0,
            0.012 0.9%,
            0.05 2%,
            0.411 9.2%,
            0.517 11.8%,
            0.611 14.6%,
            0.694 17.7%,
            0.765 21.1%,
            0.824 24.8%,
            0.872 28.9%,
            0.91 33.4%,
            0.939 38.4%,
            0.977 50.9%,
            0.994 68.4%,
            1
        )
        both;

    @media (min-width: 768px) {
        display: none;
    }
}

:root::view-transition-new(close-memo-tab-closed) {
    display: none;
    animation: none;
    /* mix-blend-mode: unset; */
}

@keyframes close-memo-tab-list-screen {
    0% {
        translate: -50% 0;
    }

    100% {
        translate: 0 0;
    }
}

@keyframes close-memo-tab-closed {
    from {
        translate: 0 0;
    }

    to {
        translate: 100% 0;
    }
}
